<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chrome AI Translator (Dropdown + Timer)</title>
</head>
<body>

  <h3>Chrome AI Translator</h3>

  <p>
    Source: 
    <select id="mySourceLang">
      <option value="it">Italian</option>
      <option value="en">English</option>
      <option value="fr">French</option>
      <option value="es">Spanish</option>
      <option value="de">German</option>
      <option value="pt">Portuguese</option>
    </select>
    → Target: 
    <select id="myTargetLang">
      <option value="en">English</option>
      <option value="it">Italian</option>
      <option value="fr">French</option>
      <option value="es">Spanish</option>
      <option value="de">German</option>
      <option value="pt">Portuguese</option>
    </select>
  </p>

  <textarea id="myInput" rows="6" cols="70" placeholder="Type text here...">Oggi è davvero una bella giornata</textarea><br>

  <input type="button" value="Translate" onclick="myHandleTranslateClick()">
  <input type="button" value="Release Translator" onclick="myReleaseTranslator()">

  <p><b>Status:</b></p>
  <div id="myStatus" style="white-space:pre-wrap;"></div>

  <textarea id="myOutput" rows="6" cols="70" placeholder="Translation here..."></textarea><br>
  <textarea id="myTextInput" rows="6" cols="70" placeholder="Translation here..."></textarea><br>

   <h1 id="myTitle">My Simple Speech App</h1>
    <p>Type some text and press the button to hear it spoken out loud.</p>

    <div>
        <label for="myLanguageSelect">Choose a language:</label>
        <select id="myLanguageSelect">
            <option value="en-US" data-starting-text="Hello World">English (United States)</option>
            <option value="es-ES" data-starting-text="Hola Mundo">Spanish (Spain)</option>
            <option value="fr-FR" data-starting-text="Bonjour le monde">French (France)</option>
            <option value="de-DE" data-starting-text="Hallo Welt">German (Germany)</option>
            <option value="ja-JP" data-starting-text="こんにちは世界">Japanese (Japan)</option>
        </select>
    </div>
    <br>

    <div>
        <label for="myVoiceSelect">Choose a voice:</label>
        <select id="myVoiceSelect"></select>
    </div>
    <br>
    

    <br><br>
    <button id="mySpeakButton">Speak Text</button>
    
    <p id="myStatusMessage"></p>
    





  
  <script>
    let myTranslator = null;
    let myTimerInterval = null;

    function mySetStatus(msg) {
      const d = document.getElementById('myStatus');
      d.textContent = msg;
    }

    function myStartTimer() {
      let sec = 0;
      mySetStatus("Working... 0s");
      myTimerInterval = setInterval(() => {
        sec++;
        mySetStatus(`Working... ${sec}s`);
      }, 1000);
    }

    function myStopTimer(msg) {
      if (myTimerInterval) clearInterval(myTimerInterval);
      myTimerInterval = null;
      mySetStatus(msg);
    }

    async function myCreateTranslator(source, target) {
      if (!('Translator' in self)) {
        mySetStatus('Translator API not available in this browser.');
        return null;
      }

      try {
        mySetStatus(`Checking availability for ${source} → ${target}...`);
        const avail = await Translator.availability({ sourceLanguage: source, targetLanguage: target });
        mySetStatus(`Availability: ${avail}`);
        if (avail === 'unavailable') return null;

        mySetStatus(`Creating translator for ${source} → ${target}...`);
        const translator = await Translator.create({
          sourceLanguage: source,
          targetLanguage: target,
          monitor(m) {
            m.addEventListener('downloadprogress', ev => {
              const loaded = ev.loaded ?? 'unknown';
              const total = ev.total ?? 'unknown';
              mySetStatus(`Downloading model: ${loaded} / ${total} bytes`);
            });
          }
        });
        return translator;
      } catch (err) {
        mySetStatus('Error creating translator: ' + (err.message || err));
        return null;
      }
    }

    async function myHandleTranslateClick() {
      const text = document.getElementById('myInput').value.trim();
      if (!text) { mySetStatus('Type some text first.'); return; }

      const source = document.getElementById('mySourceLang').value;
      const target = document.getElementById('myTargetLang').value;

      // If existing translator is for a different pair, release it
      if (myTranslator && (myTranslator.sourceLanguage !== source || myTranslator.targetLanguage !== target)) {
        await myReleaseTranslator();
      }

      if (!myTranslator) {
        myTranslator = await myCreateTranslator(source, target);
        if (!myTranslator) {
          mySetStatus('Translator could not be created.');
          return;
        }
      }

      try {
        myStartTimer();
        const result = await myTranslator.translate(text);
        myStopTimer('Translation complete.');
        document.getElementById('myOutput').textContent = result;
        document.getElementById('myTextInput').textContent = result;
      } catch (err) {
        myStopTimer('Error during translation: ' + (err.message || err));
        document.getElementById('myOutput').textContent = '';
      }
    }

    async function myReleaseTranslator() {
      if (myTranslator) {
        try {
          if (typeof myTranslator.destroy === 'function') {
            await myTranslator.destroy();
          } else if (typeof myTranslator.close === 'function') {
            await myTranslator.close();
          }
        } catch (err) {
          mySetStatus('Error releasing translator: ' + (err.message || err));
        }
        myTranslator = null;
        mySetStatus('Translator released.');
      } else {
        mySetStatus('No translator to release.');
      }
    }


     // to speak 
    
        // Use descriptive names and camelCase
        const myTextInput = document.getElementById("myTextInput");
        const mySpeakButton = document.getElementById("mySpeakButton");
        const myStatusMessage = document.getElementById("myStatusMessage");
        const myLanguageSelect = document.getElementById("myLanguageSelect");
        const myVoiceSelect = document.getElementById("myVoiceSelect");

        // Function to populate the voice dropdown
        const myPopulateVoiceList = () => {
            const myVoices = window.speechSynthesis.getVoices();
            // Clear the voice select dropdown first
            myVoiceSelect.innerHTML = '';
            
            myVoices.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = voice.name + ' (' + voice.lang + ')';
                option.setAttribute('data-lang', voice.lang);
                option.setAttribute('data-name', voice.name);
                option.value = voice.name;
                myVoiceSelect.appendChild(option);
            });
        };

        // Listen for when the browser loads the voices
        // This is a necessary step because voices are loaded asynchronously
        window.speechSynthesis.addEventListener('voiceschanged', myPopulateVoiceList);

        // Initial population if voices are already loaded
        myPopulateVoiceList();

        // Define the function
        const mySpeakFunction = () => {
            if ('speechSynthesis' in window) {
                const myTextToSpeak = myTextInput.value;
                const mySelectedVoiceName = myVoiceSelect.value;
                const mySelectedVoice = window.speechSynthesis.getVoices().find(voice => voice.name === mySelectedVoiceName);

                if (myTextToSpeak.trim() === '') {
                    myStatusMessage.textContent = 'Please enter some text to speak.';
                    return;
                }

                const myUtterance = new SpeechSynthesisUtterance(myTextToSpeak);
                myUtterance.voice = mySelectedVoice;

                // Set a simple status message while speaking
                myStatusMessage.textContent = 'Speaking...';
                
                myUtterance.onend = () => {
                    myStatusMessage.textContent = 'Finished speaking.';
                };

                myUtterance.onerror = (event) => {
                    myStatusMessage.textContent = 'An error occurred: ' + event.error;
                };

                window.speechSynthesis.speak(myUtterance);

            } else {
                myStatusMessage.textContent = 'Sorry, your browser does not support the Web Speech API.';
            }
        };

        // Event listener for when the language selection changes
        myLanguageSelect.addEventListener('change', (event) => {
            const mySelectedOption = event.target.options[event.target.selectedIndex];
            const myStartingText = mySelectedOption.getAttribute('data-starting-text');
            myTextInput.value = myStartingText;
        });

        // Set the initial textarea text
        myLanguageSelect.dispatchEvent(new Event('change'));

        // Static link to the function on the button
        mySpeakButton.onclick = mySpeakFunction;
        
    </script>



</body>
</html>
